;(function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i})({1:[function(require,module,exports){
module.exports={
    "things": [
        {
            "position": {
                "X": 0,
                "Y": 16
            },
            "type": "lava"
        },
        {
            "position": {
                "X": 8,
                "Y": 8
            },
            "type": "house"
        },
        {
            "position": {
                "X": 26,
                "Y": 14
            },
            "type": "block"
        },
        {
            "position": {
                "X": 8,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 16,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 24,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 32,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 40,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 56,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 64,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 72,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 80,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 88,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 96,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 104,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 112,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 120,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 128,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 136,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 144,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 152,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 160,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 168,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 176,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 184,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 192,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 200,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 208,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 224,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 232,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 240,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 248,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 256,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 264,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 272,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 280,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 288,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 296,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 304,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 312,
                "Y": 24
            },
            "type": "ground"
        },
        {
            "position": {
                "X": 30,
                "Y": 14
            },
            "type": "block"
        },
        {
            "position": {
                "X": 34,
                "Y": 14
            },
            "type": "block"
        },
        {
            "position": {
                "X": 48,
                "Y": 16
            },
            "type": "lava"
        },
        {
            "position": {
                "X": 69,
                "Y": 16
            },
            "type": "wall"
        },
        {
            "position": {
                "X": 79,
                "Y": 10
            },
            "type": "block"
        },
        {
            "position": {
                "X": 83,
                "Y": 10
            },
            "type": "block"
        },
        {
            "position": {
                "X": 87,
                "Y": 10
            },
            "type": "block"
        },
        {
            "position": {
                "X": 94,
                "Y": 13
            },
            "type": "block"
        },
        {
            "position": {
                "X": 96,
                "Y": 13
            },
            "type": "block"
        },
        {
            "position": {
                "X": 98,
                "Y": 13
            },
            "type": "block"
        },
        {
            "position": {
                "X": 100,
                "Y": 13
            },
            "type": "block"
        },
        {
            "position": {
                "X": 92,
                "Y": 15
            },
            "type": "block"
        },
        {
            "position": {
                "X": 102,
                "Y": 15
            },
            "type": "block"
        },
        {
            "position": {
                "X": 112,
                "Y": 19
            },
            "type": "block"
        },
        {
            "position": {
                "X": 134,
                "Y": 19
            },
            "type": "block"
        },
        {
            "position": {
                "X": 121,
                "Y": 20
            },
            "type": "enemy"
        },
        {
            "position": {
                "X": 61,
                "Y": 20
            },
            "type": "enemy"
        },
        {
            "position": {
                "X": 141,
                "Y": 8
            },
            "type": "house"
        },
        {
            "position": {
                "X": 160,
                "Y": 16
            },
            "type": "wall"
        },
        {
            "position": {
                "X": 182,
                "Y": 16
            },
            "type": "wall"
        },
        {
            "position": {
                "X": 173,
                "Y": 20
            },
            "type": "enemy"
        },
        {
            "position": {
                "X": 171,
                "Y": 20
            },
            "type": "enemy"
        },
        {
            "position": {
                "X": 216,
                "Y": 16
            },
            "type": "lava"
        },
        {
            "position": {
                "X": 214,
                "Y": 19
            },
            "type": "block"
        },
        {
            "position": {
                "X": 214,
                "Y": 17
            },
            "type": "block"
        },
        {
            "position": {
                "X": 214,
                "Y": 15
            },
            "type": "block"
        },
        {
            "position": {
                "X": 212,
                "Y": 17
            },
            "type": "block"
        },
        {
            "position": {
                "X": 210,
                "Y": 19
            },
            "type": "block"
        },
        {
            "position": {
                "X": 212,
                "Y": 19
            },
            "type": "block"
        },
        {
            "position": {
                "X": 224,
                "Y": 19
            },
            "type": "block"
        },
        {
            "position": {
                "X": 224,
                "Y": 17
            },
            "type": "block"
        },
        {
            "position": {
                "X": 224,
                "Y": 15
            },
            "type": "block"
        },
        {
            "position": {
                "X": 226,
                "Y": 17
            },
            "type": "block"
        },
        {
            "position": {
                "X": 226,
                "Y": 19
            },
            "type": "block"
        },
        {
            "position": {
                "X": 228,
                "Y": 19
            },
            "type": "block"
        },
        {
            "position": {
                "X": 204,
                "Y": 20
            },
            "type": "enemy"
        },
        {
            "position": {
                "X": 200,
                "Y": 20
            },
            "type": "enemy"
        },
        {
            "position": {
                "X": 12,
                "Y": 12
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 15,
                "Y": 12
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 18,
                "Y": 12
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 317,
                "Y": 19
            },
            "type": "block"
        },
        {
            "position": {
                "X": 317,
                "Y": 17
            },
            "type": "block"
        },
        {
            "position": {
                "X": 317,
                "Y": 15
            },
            "type": "block"
        },
        {
            "position": {
                "X": 317,
                "Y": 13
            },
            "type": "block"
        },
        {
            "position": {
                "X": 317,
                "Y": 11
            },
            "type": "block"
        },
        {
            "position": {
                "X": 317,
                "Y": 9
            },
            "type": "block"
        },
        {
            "position": {
                "X": 317,
                "Y": 7
            },
            "type": "block"
        },
        {
            "position": {
                "X": 317,
                "Y": 5
            },
            "type": "block"
        },
        {
            "position": {
                "X": 317,
                "Y": 3
            },
            "type": "block"
        },
        {
            "position": {
                "X": 317,
                "Y": 1
            },
            "type": "block"
        },
        {
            "position": {
                "X": 287,
                "Y": 19
            },
            "type": "block"
        },
        {
            "position": {
                "X": 217,
                "Y": 13
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 220,
                "Y": 13
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 83,
                "Y": 8
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 171,
                "Y": 12
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 177,
                "Y": 12
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 241,
                "Y": 16
            },
            "type": "wall"
        },
        {
            "position": {
                "X": 256,
                "Y": 16
            },
            "type": "wall"
        },
        {
            "position": {
                "X": 256,
                "Y": 10
            },
            "type": "wall"
        },
        {
            "position": {
                "X": 249,
                "Y": 21
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 252,
                "Y": 21
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 251,
                "Y": 11
            },
            "type": "block"
        },
        {
            "position": {
                "X": 263,
                "Y": 14
            },
            "type": "block"
        },
        {
            "position": {
                "X": 265,
                "Y": 14
            },
            "type": "block"
        },
        {
            "position": {
                "X": 267,
                "Y": 14
            },
            "type": "block"
        },
        {
            "position": {
                "X": 269,
                "Y": 14
            },
            "type": "block"
        },
        {
            "position": {
                "X": 271,
                "Y": 14
            },
            "type": "block"
        },
        {
            "position": {
                "X": 268,
                "Y": 13
            },
            "type": "enemy"
        },
        {
            "position": {
                "X": 278,
                "Y": 20
            },
            "type": "enemy"
        },
        {
            "position": {
                "X": 264,
                "Y": 21
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 267,
                "Y": 21
            },
            "type": "coin"
        },
        {
            "position": {
                "X": 299,
                "Y": 16
            },
            "type": "door"
        }
    ]
}

},{}],2:[function(require,module,exports){
module.exports={"things":[{"type":"ground","position":{"X":8,"Y":24}},{"type":"ground","position":{"X":16,"Y":24}},{"type":"ground","position":{"X":72,"Y":24}},{"type":"ground","position":{"X":80,"Y":24}},{"type":"ground","position":{"X":88,"Y":24}},{"type":"ground","position":{"X":96,"Y":24}},{"type":"ground","position":{"X":104,"Y":24}},{"type":"ground","position":{"X":112,"Y":24}},{"type":"ground","position":{"X":120,"Y":24}},{"type":"ground","position":{"X":128,"Y":24}},{"type":"ground","position":{"X":136,"Y":24}},{"type":"ground","position":{"X":144,"Y":24}},{"type":"ground","position":{"X":152,"Y":24}},{"type":"ground","position":{"X":160,"Y":24}},{"type":"ground","position":{"X":168,"Y":24}},{"type":"ground","position":{"X":176,"Y":24}},{"type":"ground","position":{"X":184,"Y":24}},{"type":"ground","position":{"X":192,"Y":24}},{"type":"ground","position":{"X":200,"Y":24}},{"type":"ground","position":{"X":208,"Y":24}},{"type":"ground","position":{"X":224,"Y":24}},{"type":"ground","position":{"X":248,"Y":24}},{"type":"ground","position":{"X":256,"Y":24}},{"type":"ground","position":{"X":264,"Y":24}},{"type":"ground","position":{"X":272,"Y":24}},{"type":"ground","position":{"X":280,"Y":24}},{"type":"ground","position":{"X":288,"Y":24}},{"type":"ground","position":{"X":296,"Y":24}},{"type":"ground","position":{"X":304,"Y":24}},{"type":"ground","position":{"X":312,"Y":24}},{"type":"lava","position":{"X":48,"Y":16}},{"type":"block","position":{"X":100,"Y":13}},{"type":"block","position":{"X":92,"Y":15}},{"type":"block","position":{"X":102,"Y":15}},{"type":"enemy","position":{"X":100,"Y":20}},{"type":"wall","position":{"X":160,"Y":16}},{"type":"lava","position":{"X":216,"Y":16}},{"type":"block","position":{"X":214,"Y":19}},{"type":"block","position":{"X":214,"Y":17}},{"type":"block","position":{"X":214,"Y":15}},{"type":"block","position":{"X":212,"Y":17}},{"type":"block","position":{"X":210,"Y":19}},{"type":"block","position":{"X":212,"Y":19}},{"type":"block","position":{"X":224,"Y":19}},{"type":"block","position":{"X":224,"Y":17}},{"type":"block","position":{"X":224,"Y":15}},{"type":"block","position":{"X":226,"Y":17}},{"type":"block","position":{"X":226,"Y":19}},{"type":"block","position":{"X":228,"Y":19}},{"type":"enemy","position":{"X":201,"Y":20}},{"type":"enemy","position":{"X":197,"Y":20}},{"type":"block","position":{"X":317,"Y":19}},{"type":"block","position":{"X":317,"Y":17}},{"type":"block","position":{"X":317,"Y":15}},{"type":"block","position":{"X":317,"Y":13}},{"type":"block","position":{"X":317,"Y":11}},{"type":"block","position":{"X":317,"Y":9}},{"type":"block","position":{"X":317,"Y":7}},{"type":"block","position":{"X":317,"Y":5}},{"type":"block","position":{"X":317,"Y":3}},{"type":"block","position":{"X":317,"Y":1}},{"type":"block","position":{"X":287,"Y":19}},{"type":"coin","position":{"X":217,"Y":13}},{"type":"coin","position":{"X":220,"Y":13}},{"type":"wall","position":{"X":256,"Y":16}},{"type":"wall","position":{"X":256,"Y":10}},{"type":"coin","position":{"X":249,"Y":21}},{"type":"coin","position":{"X":252,"Y":21}},{"type":"block","position":{"X":251,"Y":11}},{"type":"enemy","position":{"X":281,"Y":20}},{"type":"door","position":{"X":299,"Y":16}},{"type":"ground","position":{"X":0,"Y":24}},{"type":"ground","position":{"X":24,"Y":24}},{"type":"lava","position":{"X":40,"Y":16}},{"type":"lava","position":{"X":32,"Y":16}},{"type":"block","position":{"X":56,"Y":19}},{"type":"block","position":{"X":56,"Y":15}},{"type":"block","position":{"X":58,"Y":15}},{"type":"block","position":{"X":58,"Y":19}},{"type":"block","position":{"X":60,"Y":19}},{"type":"block","position":{"X":62,"Y":19}},{"type":"platform","position":{"X":48,"Y":24}},{"type":"lava","position":{"X":64,"Y":16}},{"type":"lava","position":{"X":56,"Y":16}},{"type":"coin","position":{"X":42,"Y":18}},{"type":"coin","position":{"X":46,"Y":16}},{"type":"coin","position":{"X":50,"Y":18}},{"type":"house","position":{"X":73,"Y":8}},{"type":"coin","position":{"X":77,"Y":12}},{"type":"coin","position":{"X":80,"Y":12}},{"type":"coin","position":{"X":83,"Y":12}},{"type":"wall","position":{"X":93,"Y":16}},{"type":"platform","position":{"X":141,"Y":18}},{"type":"enemy","position":{"X":130,"Y":20}},{"type":"enemy","position":{"X":111,"Y":20}},{"type":"enemy","position":{"X":108,"Y":20}},{"type":"enemy","position":{"X":104,"Y":20}},{"type":"wall","position":{"X":160,"Y":10}},{"type":"wall","position":{"X":208,"Y":10}},{"type":"block","position":{"X":210,"Y":17}},{"type":"block","position":{"X":212,"Y":15}},{"type":"block","position":{"X":210,"Y":15}},{"type":"block","position":{"X":208,"Y":15}},{"type":"block","position":{"X":208,"Y":17}},{"type":"block","position":{"X":208,"Y":19}},{"type":"block","position":{"X":206,"Y":19}},{"type":"block","position":{"X":206,"Y":17}},{"type":"block","position":{"X":204,"Y":19}},{"type":"platform","position":{"X":169,"Y":12}},{"type":"coin","position":{"X":168,"Y":17}},{"type":"coin","position":{"X":171,"Y":17}},{"type":"coin","position":{"X":174,"Y":17}},{"type":"coin","position":{"X":202,"Y":18}},{"type":"coin","position":{"X":205,"Y":16}},{"type":"coin","position":{"X":199,"Y":18}},{"type":"lava","position":{"X":232,"Y":16}},{"type":"lava","position":{"X":240,"Y":16}},{"type":"block","position":{"X":234,"Y":15}},{"type":"block","position":{"X":236,"Y":15}},{"type":"block","position":{"X":238,"Y":15}},{"type":"block","position":{"X":240,"Y":15}},{"type":"block","position":{"X":249,"Y":11}},{"type":"block","position":{"X":247,"Y":11}},{"type":"block","position":{"X":265,"Y":11}},{"type":"block","position":{"X":269,"Y":13}},{"type":"block","position":{"X":273,"Y":15}}]}
},{}],3:[function(require,module,exports){
/*jshint node:true, bitwise:false, browser:true */
'use strict';
var jsgtb = require('jsgtb');

var game = jsgtb.game; //require('jsgtb/game');
var keys = jsgtb.keys; //require('jsgtb/keys');

var Character = require('./character');
var World = require('./world');
var Logo = require('./logo');
var data = require('./1-1.json');
var levels = [
    { name: '1-1', data: require('./1-1.json') },
    { name: '1-2', data: require('./1-2.json') }
];
var resources = new game.Resources();
//var Physics = require('./physics');
//console.log(Physics);

//var physics = new Physics();

//console.log(physics);

//this is the visible canvas
jsgtb.canvas.size(320, 320);
//wow. such smoothing.
jsgtb.canvas.context.imageSmoothingEnabled = false;
jsgtb.canvas.context.mozImageSmoothingEnabled = false;
var gameView = jsgtb.canvas.create();
//this where we render the game. Only 32x32 is visible, the rest we scroll around to.
gameView.size(320, 32);
var level = 0;
resources.on('load', function() {
    var editor = false;
    var editorMode = {
        current: 'block'
    };
    function selectTool(e) {
        editorMode.current = e.target.getAttribute('tile');
    }

    var editorButtons = document.querySelectorAll('#editormode>a');
    for(var i = 0; i < editorButtons.length; i++) {
        editorButtons[i].addEventListener('click', selectTool);
    }
    var play = new jsgtb.GameObject();
    var world = new World(game, data);
    var character = new Character(game, 16, 20);
    var scroll = 0;
    play.on('init', function() {
        scroll = 0;
        character = new Character(game, 16, 20);
        world = new World(game, levels[level].data);
        //character.position.X = 16;
        //character.position.Y = 20;
        //character.setAnimation('idle');
        resources.music.play(true);
        character.on('death', function() {
            console.log('back to title screen');
            level = 0;
            game.state = logo;
        });
        character.on('win', function() {
            level++;
            if(level > levels.length) {
                level = 0;
            }
            game.state = logo;
        });
    });
    play.on('clear', function() {
        resources.music.stop();
    });
    play.on('keydown', function(key) {
        if(key.code === keys.RIGHT) {
            character.right();
        }
        if(key.code === keys.LEFT) {
            character.left();
        }
        if(key.code === keys.UP) {
            character.jump();
        }
        if(editor) {
            if(key.code === keys.A) {
                scroll--;
            }
            if(key.code === keys.D) {
                scroll++;
            }
        }
    });
    play.on('keyup', function(key) {
        if (key.code === keys.RIGHT ||
            key.code === keys.LEFT) {
            character.idle();
        }
        if(key.code === keys.UP) {
        }
        if(key.code === keys.F2) {
            console.log('secret editor mode.');
            document.getElementById('editormode').style.display = 'block';
            editor = true;
        }
        if(key.code === keys.F4) {
            world.dump();
        }
    });
    var mouse = {X :0, Y: 0};
    play.on('mousemove', function(e) {
        mouse = e;
    });
    play.on('click', function(e) {
        if(!editor) {
            return;
        }
        var position = {
            X: (e.X / 10 | 0) + scroll,
            Y: (e.Y / 10 | 0)
        };
        console.log(e);
        if(e.button === 0) {
            world.add({
                type: editorMode.current,
                position: position
            });
        } else {
            var thing = world.collides(position.X, position.Y);
            if(thing) {
                world.remove(thing);
            }
        }
    });
    play.on('draw', function(e) {
        gameView.context.fillStyle = 'white';
        gameView.context.fillRect(0, 0, 320, 32);
        for(var i = 0; i < 16; i++) {
            gameView.context.drawImage(resources.sky, i * 32, 0);
        }
        world.draw(gameView);
        character.draw(gameView);
        if(character.position.X > 16) {
            scroll = character.position.X - 16;
        }
        gameView.context.fillText(levels[level].name, 0, 10);
        e.canvas.context.drawImage(gameView.element, scroll, 0, 32, 32, 0, 0, 320, 320);
        if(editor) {
            var bb = world.getBB(editorMode.current);
            e.canvas.context.strokeRect((mouse.X / 10 | 0) * 10 + bb.X * 10, (mouse.Y / 10 | 0) * 10 + bb.Y * 10, bb.width * 10, bb.height * 10);
        }
    });
    var action = 0;
    play.on('update', function() {
        var now = Date.now();
        var actionTime = false;
        if(now - action > 100) {
            actionTime = true;
            action = now;
        }
        //physics.step(now);
        character.update(world, actionTime);
        world.update(actionTime);
    });

    //game.state = play;
    var logo = new Logo(game);
    logo.on('dismiss', function() {
        game.state = play;
    });
    game.state = logo;
    game.run();
});

resources.load({
    'ground': 'images/ground.png',
    'sprites': 'images/sprites3.png',
    'coin': 'images/coin2.png',
    'crooked': 'images/32crooked.png',
    'lava': 'images/lava.png',
    'house': 'images/house.png',
    'block': 'images/block.png',
    'sky': 'images/sky.png',
    'enemy': 'images/enemy.png',
    'music': 'audio/music.mp3',
    'jump': 'audio/jump.mp3',
    'pickup': 'audio/pickup.mp3',
    'powerup': 'audio/powerup.mp3',
    'hurt': 'audio/hurt.mp3',
    'wall': 'images/wall.png',
    'door': 'images/door.png',
    'platform': 'images/platform.png',
    'shortplatform': 'images/shortplatform.png'
});

},{"./1-1.json":1,"./1-2.json":2,"./character":4,"./world":5,"./logo":6,"jsgtb":7}],5:[function(require,module,exports){
/*jshint node:true, bitwise:false */
'use strict';

var jsgtb = require('jsgtb');
var Thing = require('./thing');
var Enemy = require('./enemy');
var Platform = require('./platform');
var ShortPlatform = function(game, x, y) {
    return new Platform(game, x, y, true);
};
var World = function(game, data) {
    var resources = new game.Resources();
    var things = [];
    var render = {};
    var map = [];
    var x, y;
    for(x = 0; x < 320; x++) {
        map[x] = [];
        for(y = 0; y < 32; y++) {
            map[x][y] = 0;
        }
    }
    render.lava = {
        image: resources.lava,
        size: {
            width: 8,
            height: 16
        },
        bbox: {
            X: 0,
            Y: 11,
            width: 8,
            height: 5
        },
        animations: {
            idle: {
                frames: [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8],
                fps: 10
            }
        }
    };
    render.enemy = {
        image: resources.enemy,
        bbox: {
            X: 1,
            Y: 0,
            width: 2,
            height: 4
        },
        size: {
            width: 4,
            height: 4
        },
        animations: {
            idle: {
                frames: [0, 1],
                fps: 5
            },
            walk: {
                frames: [0, 1],
                fps: 5
            },
            death: {
                frames: [0, 1, 2, 3, 4, 5],
                fps: 10,
                noloop: true
            }
        }
    };
    render.ground = {
        image: resources.ground,
        size: {
            width: 8,
            height: 8
        },
        bbox: {
            X: 0,
            Y: 0,
            width: 8,
            height: 8
        },
        animations: {
            idle: {
                frames: [0],
                fps: 0
            }
        }
    };
    render.wall = {
        image: resources.wall,
        size: {
            width: 8,
            height: 8
        },
        bbox: {
            X: 0,
            Y: 2,
            width: 8,
            height: 6
        },
        animations: {
            idle: {
                frames: [0],
                fps: 0
            }
        }
    };
    render.door = {
        image: resources.door,
        size: {
            width: 8,
            height: 8
        },
        bbox: {
            X: 0,
            Y: 2,
            width: 8,
            height: 6
        },
        animations: {
            idle: {
                frames: [0],
                fps: 0
            }
        }
    };
    render.coin = {
        image: resources.coin,
        size: {
            width: 2,
            height: 2
        },
        bbox: {
            X: 0,
            Y: 0,
            width: 2,
            height: 2
        },
        animations: {
            idle: {
                frames: [0, 1, 2, 3],
                fps: 5
            }
        }
    };
    render.platform = {
        size: {
            width: 16,
            height: 2
        },
        bbox: {
            X: 0,
            Y: 0,
            width: 16,
            height: 2
        }
    };
    render.shortplatform = {
        size: {
            width: 4,
            height: 2
        },
        bbox: {
            X: 0,
            Y: 0,
            width: 4,
            height: 2
        }
    };
    render.house = {
        image: resources.house,
        size: {
            width: 16,
            height: 16
        },
        bbox: {
            X: 0,
            Y: 7,
            width: 16,
            height: 1
        },
        animations: {
            idle: {
                frames: [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 5, 6, 7],
                fps: 10
            }
        }
    };
    render.block = {
        image: resources.block,
        size: {
            width: 2,
            height: 5
        },
        bbox: {
            X: 0,
            Y: 3,
            width: 2,
            height: 1
        },
        animations: {
            idle: {
                frames: [0],
                fps: 0
            },
            bump: {
                frames: [0, 1],
                fps: 5,
                noloop: true
            },
            vanish: {
                frames: [0, 2, 3],
                fps: 5,
                noloop: true
            }
        }
    };
    var world = new jsgtb.GameObject();
    world({
        update: function(actionTime) {
            for(var i = 0; i < things.length; i++) {
                if(things[i].update) {
                    things[i].update(world, actionTime);
                }
            }
        },
        draw: function(canvas) {
            for(var i = 0; i < things.length; i++) {
                //if(things[i].update) {
                    //things[i].update(world);
                //}
                things[i].draw(canvas);
            }
        },
        collides: function(x, y) {
            if(map[x] && map[x][y]) {
                return map[x][y].gone ? null : map[x][y];
            } else {
                return null;
            }
        },
        remove: function(thing) {
            console.log('trying to remove thing');
            for(var i = 0; i < things.length; i++) {
                if(things[i] === thing) {
                    thing.gone = true;
                    things.splice(i, 1);
                    break;
                }
            }
        },
        addBB: function(owner, X, Y, bbox) {
            for(x = bbox.X; x < bbox.X + bbox.width; x++) {
                for(y = bbox.Y; y < bbox.Y + bbox.height; y++) {
                    map [X + x]
                        [Y + y] = owner;
                }
            }
        },
        add: function(thing) {
            switch(thing.type) {
                case 'enemy':
                    things.push(
                            new Enemy(game,
                                thing.position.X,
                                thing.position.Y)
                    );
                    break;
                case 'platform':
                    things.push(
                            new Platform(game,
                                thing.position.X,
                                thing.position.Y)
                    );
                    break;
                case 'shortplatform':
                    things.push(
                            new ShortPlatform(game,
                                thing.position.X,
                                thing.position.Y)
                    );
                    break;
                default:
                    things.push(
                            new Thing(game,
                                thing.position.X,
                                thing.position.Y,
                                render[thing.type],
                                thing.type)
                    );

            }
            //if(thing.type === 'enemy') {
                //things.push(
                        //new Enemy(game,
                            //thing.position.X,
                            //thing.position.Y)
                //);

            //} else {
                //things.push(
                        //new Thing(game,
                            //thing.position.X,
                            //thing.position.Y,
                            //render[thing.type],
                            //thing.type)
                //);
            //}
            var bbox = render[thing.type].bbox || {
                X: 0,
                Y: 0,
                width: render[thing.type].size.width,
                height: render[thing.type].size.height
            };
            for(x = bbox.X; x < bbox.X + bbox.width; x++) {
                for(y = bbox.Y; y < bbox.Y + bbox.height; y++) {
                    map [thing.position.X + x]
                        [thing.position.Y + y] = things[things.length - 1];
                }
            }
        },
        getBB: function(thing) {
            return render[thing].bbox;
        },
        dump: function() {
            var data = { things: [] };
            for(var i = 0; i < things.length; i++) {
                data.things.push({
                    type: things[i].type,
                    position: things[i].position
                });
            }
            console.log(data);
            console.log(JSON.stringify(data));
        }
    });
    if(data && data.things) {
        for(var i = 0; i < data.things.length; i++) {
            world.add(data.things[i]);
            /*
            things.push(
                    new Thing(game,
                        data.things[i].position.X,
                        data.things[i].position.Y,
                        render[data.things[i].type],
                        data.things[i].type)
            );
            var bbox = render[data.things[i].type].bbox || {
                X: 0, //data.things[i].position.X,
                Y: 0, //.data.things[i].position.Y,
                width: render[data.things[i].type].size.width,
                height: render[data.things[i].type].size.height
            };
            for(x = bbox.X; x < bbox.X + bbox.width; x++) {
                for(y = bbox.Y; y < bbox.Y + bbox.height; y++) {
                    map [data.things[i].position.X + x]
                        [data.things[i].position.Y + y] = things[things.length - 1];
                }
            }*/
        }
    }
    return world;
};

module.exports = World;

},{"./thing":8,"./enemy":9,"./platform":10,"jsgtb":7}],4:[function(require,module,exports){
/*jshint node:true */
'use strict';
var jsgtb = require('jsgtb');
var Thing = require('./thing');

var Character = function(game, x, y) {
    var resources = new game.Resources();
    var coins = 0;
    var render = {
        image: resources.sprites,
        size: {
            width: 4,
            height: 4
        },
        bbox: {
            X: 1,
            Y: 0,
            width: 2,
            height: 4
        },
        animations: {
            walk: {
                frames: [1, 2, 3, 4],
                fps: 10
            },
            jump: {
                frames: [0, 5, 6],
                fps: 10,
                noloop: true
            },
            idle: {
                frames: [0, 0, 0, 5],
                fps: 2
            },
            death: {
                frames: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 15, 15, 15, 15, 15],
                fps: 10,
                noloop: true
            }
        }
    };
    var character = new jsgtb.GameObject();
    var moving = 'idle';
    var action = 0;
    var jumpTime = 99;
    var grounded = true;
    var dying = false;
    var die = function(reason) {
        if(dying) { return; }
        if(reason) {
            console.log('died because of ' + reason);
        } else {
            console.log('died for no reason.');
        }
        dying = true;
        resources.hurt.play();
        character.setAnimation('death', function() {
            dying = false;
            character.fire('death');
        });
    };
    character(new Thing(game, x, y, render));
    character({
        right: function() {
            moving = 'right';
        },
        left: function() {
            moving = 'left';
        },
        idle: function() {
            character.setAnimation('idle');
            moving = 'idle';
        },
        jump: function() {
            if(grounded && !dying) {
                jumpTime = 0; //Date.now();
                character.setAnimation('jump');
                resources.jump.play();
            }
        },
        update: function(world, actionTime) {
            var grabCoin = function(coin) {
                resources.pickup.play();
                coins++;
                world.remove(coin);
            };
            var killEnemy = function(enemy) {
                character.jump();
                enemy.idle();
                resources.powerup.play();
                enemy.setAnimation('death', function() {
                    world.remove(enemy);
                });
            };
            var vanishBlock = function(block) {
                block.setAnimation('vanish', function() {
                    world.remove(block);
                });
            };
            var now = Date.now();
            //if(dying && character.getAnimation() !== 'death') {
                //character.setAnimation('death');
            //}
            //if(now - action > 100) {
            if(actionTime) {
                action = now;
                var leftFoot = world.collides(character.position.X + 1, character.position.Y + 4);
                var rightFoot = world.collides(character.position.X + 2, character.position.Y + 4);
                if (!leftFoot && !rightFoot) {
                    grounded = false;
                } else {
                    grounded = true;
                    if ((leftFoot && leftFoot.type === 'platform') ||
                        (rightFoot && rightFoot.type === 'platform')) {
                        character.position.X += (leftFoot || rightFoot).direction === 'right' ? 1 : -1;
                    }
                    if ((leftFoot && leftFoot.type === 'lava') ||
                        (rightFoot && rightFoot.type === 'lava')) {
                        die('lava');
                    }
                    if((leftFoot && leftFoot.type === 'enemy') ||
                        (rightFoot && rightFoot.type === 'enemy')) {
                        if(leftFoot === rightFoot) {
                            killEnemy(leftFoot); //.setAnimation('death');
                        } else {
                            if(leftFoot && leftFoot.type === 'enemy') {
                                killEnemy(leftFoot); //.setAnimation('death');
                            } else if(rightFoot){
                                killEnemy(rightFoot); //.setAnimation('death');
                            }
                        }
                    }
                    if(leftFoot && leftFoot.type === 'coin') {
                        grabCoin(leftFoot);
                    }
                    if(rightFoot && rightFoot !== leftFoot && rightFoot.type === 'coin') {
                        grabCoin(rightFoot);
                    }
                }
                var checkBox = function(box, wallsOnly) {
                    if(!box) { return false; }
                    if(wallsOnly) {
                        if(box.type !== 'coin' && box.type !== 'door' && box.type !== 'enemy') {
                            //if(moving === 'left' || moving === 'right') {
                                //moving = 'idle';
                            //}
                            return true;
                        }
                        return false;
                    }
                    if(box.type === 'door') { character.fire('win'); }
                    if(box.type === 'enemy') { die('enemy'); }
                    if(box.type === 'coin') {
                        grabCoin(box);
                    } else {
                        return true;
                        //if(moving === 'left' || moving === 'right') {
                            //moving = 'idle';
                        //}
                    }
                };
                for(var lf = 0; lf < 4; lf++) {
                    var box = world.collides(character.position.X + 1, character.position.Y + lf);
                    if(checkBox(box) && moving === 'left') {
                        moving = 'idle';
                    }
                    box = world.collides(character.position.X + 2, character.position.Y + lf);
                    if(checkBox(box) && moving === 'right') {
                        moving = 'idle';
                    }

                    if(moving === 'left' && checkBox(world.collides(character.position.X, character.position.Y + lf), true)) {
                        moving = 'idle';
                    }
                    if(moving === 'right' && checkBox(world.collides(character.position.X + 3, character.position.Y + lf), true)) {
                        moving = 'idle';
                    }
                }
                if(jumpTime < 8) {
                    character.position.Y--;
                    jumpTime++;
                    var head1 = world.collides(character.position.X + 1, character.position.Y - 1);
                    var head2 = world.collides(character.position.X + 2, character.position.Y - 1);
                    var boopBlock = function(block) {
                        if(!block.boop) {
                            block.boop = 0;
                        }
                        jumpTime = 99;
                        if(block.boop === 0) {
                            block.setAnimation('bump');
                        } else {
                            vanishBlock(block);
                        }
                        block.boop++;
                    };
                    if((head1 && head1.type === 'block') || (head2 && head2.type === 'block')) {
                        if(head1 === head2) {
                            boopBlock(head1);
                        } else {
                            if(head1 && head1.type === 'block') {
                                boopBlock(head1);
                            }
                            if(head2 && head2.type === 'block') {
                                boopBlock(head2);
                            }
                        }
                    }
                } else {
                    if(!grounded) {
                        character.position.Y++;

                    }
                }
                if(!dying) {
                    switch(moving) {
                        case 'idle':
                            break;
                        case 'right':
                            character.setAnimation('walk');
                            character.position.X++;
                            break;
                        case 'left':
                            character.setAnimation('walk');
                            character.position.X--;
                            break;
                    }
                } else {
                    console.log('cant move: dying!');
                }
            }
        }
    });

    return character;
};

module.exports = Character;

},{"./thing":8,"jsgtb":7}],6:[function(require,module,exports){
/*jshint node:true */
'use strict';

var jsgtb = require('jsgtb');
var Logo = function(game) {
    var resources = new game.Resources();
    var logo = new jsgtb.GameObject();
    var close = false;
    var start, alpha;
    logo.on('init', function() {
        start = Date.now();
        alpha = 0.0;
        close = false;
    });
    logo.on('draw', function(e) {
        var now = Date.now();
        if(!close && alpha < 1.0 && now - start > 40) {
            alpha += 0.1;
            start = now;
        }
        if(close && alpha > 0.0 && now - start > 40) {
            alpha -= 0.1;
            start = now;
            if(alpha <= 0.0) {
                logo.fire('dismiss');
            }
        }
        e.canvas.clear('black');
        e.canvas.context.save();
        e.canvas.context.globalAlpha = alpha;
        e.canvas.context.drawImage(resources.crooked, 0, 0, 32, 32, 0, 0, 320, 320);
        e.canvas.context.restore();
    });
    var anykey = function() { close = true; };
    logo.on('click', anykey);
    logo.on('keyup', anykey);
    return logo;
};

module.exports = Logo;

},{"jsgtb":7}],8:[function(require,module,exports){
/*jshint node:true */
'use strict';
var jsgtb = require('jsgtb');

var Thing = function(game, x, y, render, type) {
    var thing = new jsgtb.GameObject();
    var animation = 'idle';
    var callback = null;
    var now = Date.now();
    var i = 0;
    var position = {X: x, Y: y};
    if(!render.size) {
        render.size = {
            width: 4,
            height: 4
        };
    }
    var draw = function(canvas) {
        if (render.animations[animation].fps &&
            render.animations[animation].fps > 0 &&
            Date.now() - now > 1000 / render.animations[animation].fps) {
            now = Date.now();
            i++;
            if(i >= render.animations[animation].frames.length) {
                i = 0;
                if(render.animations[animation].noloop) {
                    if(callback) {
                        callback();
                    } else {
                        animation = 'idle';
                    }
                }
            }
        }
        canvas.context.drawImage(   render.image,
                                    render.animations[animation].frames[i] * render.size.width,
                                    0,
                                    render.size.width,
                                    render.size.height,
                                    position.X,
                                    position.Y,
                                    render.size.width,
                                    render.size.height);
    };
    thing({
        draw: draw,
        getAnimation: function() {
            return animation;
        },
        setAnimation: function(ani, aniCallback) {
            if(animation !== ani && animation !== 'death') { //death cannot be canceled
                i = 0;
                animation = ani;
                callback = aniCallback;
            }
        },
        position: position,
        type: type
    });
    return thing;
};

module.exports = Thing;

},{"jsgtb":7}],9:[function(require,module,exports){
/*jshint node:true */
'use strict';
var jsgtb = require('jsgtb');
var Thing = require('./thing');

var Enemy = function(game, x, y) {
    var resources = new game.Resources();
    var render = {
        image: resources.enemy,
        bbox: {
            X: 1,
            Y: 0,
            width: 2,
            height: 4
        },
        size: {
            width: 4,
            height: 4
        },
        animations: {
            idle: {
                frames: [0, 1],
                fps: 5
            },
            walk: {
                frames: [0, 1],
                fps: 5
            },
            death: {
                frames: [0, 1, 2, 3, 4, 5],
                fps: 10,
                noloop: true
            }
        }
    };
    var enemy = new jsgtb.GameObject();
    var moving = 'right';
    var action = 0;
    var grounded = true;
    var dying = false;
    var die = function() {
        dying = true;
        enemy.setAnimation('death', function() {
            dying = false;
            enemy.fire('death');
        });
    };
    var reverse = function() {
        if(moving === 'right') {
            moving = 'left';
        } else {
            moving = 'right';
        }
    };
    enemy(new Thing(game, x, y, render));
    enemy({
        type: 'enemy',
        right: function() {
            moving = 'right';
        },
        left: function() {
            moving = 'left';
        },
        idle: function() {
            enemy.setAnimation('idle');
            moving = 'idle';
        },
        update: function(world, actionTime) {
            var now = Date.now();
            if(actionTime) {
                action = now;
                var leftFoot = world.collides(enemy.position.X + 1, enemy.position.Y + 4);
                var rightFoot = world.collides(enemy.position.X + 2, enemy.position.Y + 4);
                if(!leftFoot || !rightFoot) {
                    reverse();
                }
                if (!leftFoot && !rightFoot) {
                    grounded = false;
                } else {
                    grounded = true;
                    if ((leftFoot && leftFoot.type === 'lava') ||
                        (rightFoot && rightFoot.type === 'lava')) {
                        die();
                    }
                }
                for(var lf = 0; lf < 4; lf++) {
                    var box1 = world.collides(enemy.position.X, enemy.position.Y + lf);
                    var box2 = world.collides(enemy.position.X + 3, enemy.position.Y + lf);
                    if(box1 && box1 !== enemy && moving === 'left' ) {//|| box2) {
                        reverse();
                        break;
                    }
                    if(box2 && box2 !== enemy && moving === 'right' ) {//|| box2) {
                        reverse();
                        break;
                    }
                }
                //if(jumpTime < 8) {
                    //enemy.position.Y--;
                    //jumpTime++;
                    //var head1 = world.collides(enemy.position.X + 1, enemy.position.Y - 1);
                    //var head2 = world.collides(enemy.position.X + 2, enemy.position.Y - 1);
                    //var boopBlock = function(block) {
                        //if(!block.boop) {
                            //block.boop = 0;
                        //}
                        //jumpTime = 99;
                        //if(block.boop === 0) {
                            //block.setAnimation('bump');
                        //} else {
                            //vanishBlock(block);
                        //}
                        //block.boop++;
                    //};
                    //if((head1 && head1.type === 'block') || (head2 && head2.type === 'block')) {
                        //if(head1 === head2) {
                            //boopBlock(head1);
                        //} else {
                            //if(head1 && head1.type === 'block') {
                                //boopBlock(head1);
                            //}
                            //if(head2 && head2.type === 'block') {
                                //boopBlock(head2);
                            //}
                        //}
                    //}
                //} else {
                    //if(!grounded) {
                        //enemy.position.Y++;

                    //}
                //}
                if(!dying) {
                    switch(moving) {
                        case 'idle':
                            break;
                        case 'right':
                            world.addBB(0, enemy.position.X, enemy.position.Y, render.bbox);
                            enemy.setAnimation('walk');
                            enemy.position.X++;
                            world.addBB(enemy, enemy.position.X, enemy.position.Y, render.bbox);
                            break;
                        case 'left':
                            world.addBB(0, enemy.position.X, enemy.position.Y, render.bbox);
                            enemy.setAnimation('walk');
                            enemy.position.X--;
                            world.addBB(enemy, enemy.position.X, enemy.position.Y, render.bbox);
                            break;
                    }
                }
            }
        }
    });

    return enemy;
};

module.exports = Enemy;

},{"./thing":8,"jsgtb":7}],10:[function(require,module,exports){
/*jshint node:true */
'use strict';
var jsgtb = require('jsgtb');
var Thing = require('./thing');

var Platform = function(game, x, y, short) {
    var resources = new game.Resources();
    var render = {
        image: resources.platform,
        bbox: {
            X: 0,
            Y: 0,
            width: 16,
            height: 2
        },
        size: {
            width: 16,
            height: 2
        },
        animations: {
            idle: {
                frames: [0],
                fps: 0
            },
            walk: {
                frames: [0],
                fps: 0
            }
        }
    };
    if(short) {
        render.bbox.width = 4;
        render.size.width = 4;
        render.image = resources.shortplatform;
    }
    var platform = new jsgtb.GameObject();
    var moving = 'right';
    platform.direction = moving;
    var action = 0;
    //var grounded = true;
    var dying = false;
    //var die = function() {
        //dying = true;
        //platform.setAnimation('death', function() {
            //dying = false;
            //platform.fire('death');
        //});
    //};
    var reverse = function() {
        if(moving === 'right') {
            moving = 'left';
        } else {
            moving = 'right';
        }
        platform.direction = moving;
    };
    platform(new Thing(game, x, y, render));
    platform({
        type: 'platform',
        right: function() {
            moving = 'right';
        },
        left: function() {
            moving = 'left';
        },
        idle: function() {
            platform.setAnimation('idle');
            moving = 'idle';
        },
        update: function(world, actionTime) {
            var now = Date.now();
            if(actionTime) {
                action = now;
                var leftFoot = world.collides(platform.position.X - 1, platform.position.Y + 1);
                var rightFoot = world.collides(platform.position.X + 16, platform.position.Y + 1);
                //if(!leftFoot || !rightFoot) {
                    //reverse();
                //}
                //if (!leftFoot && !rightFoot) {
                    //grounded = false;
                //} else {
                    //grounded = true;
                    //if ((leftFoot && leftFoot.type === 'lava') ||
                        //(rightFoot && rightFoot.type === 'lava')) {
                        //die();
                    //}
                //}
                //for(var lf = 0; lf < 4; lf++) {
                    //var box1 = world.collides(platform.position.X, platform.position.Y + lf);
                    //var box2 = world.collides(platform.position.X + 3, platform.position.Y + lf);

                if(leftFoot && moving === 'left' ) {//|| box2) {
                    reverse();
                    //break;
                }
                if(rightFoot && moving === 'right' ) {//|| box2) {
                    reverse();
                    //break;
                }
                for(var i = 0; i < 16; i++) {
                    var player = world.collides(platform.position.X + i, platform.position.Y - 1);
                    if(player) {
                        player.position.X += (moving === 'right' ? 1 : -1);
                        break;
                    }
                }
                //}
                //if(jumpTime < 8) {
                    //platform.position.Y--;
                    //jumpTime++;
                    //var head1 = world.collides(platform.position.X + 1, platform.position.Y - 1);
                    //var head2 = world.collides(platform.position.X + 2, platform.position.Y - 1);
                    //var boopBlock = function(block) {
                        //if(!block.boop) {
                            //block.boop = 0;
                        //}
                        //jumpTime = 99;
                        //if(block.boop === 0) {
                            //block.setAnimation('bump');
                        //} else {
                            //vanishBlock(block);
                        //}
                        //block.boop++;
                    //};
                    //if((head1 && head1.type === 'block') || (head2 && head2.type === 'block')) {
                        //if(head1 === head2) {
                            //boopBlock(head1);
                        //} else {
                            //if(head1 && head1.type === 'block') {
                                //boopBlock(head1);
                            //}
                            //if(head2 && head2.type === 'block') {
                                //boopBlock(head2);
                            //}
                        //}
                    //}
                //} else {
                    //if(!grounded) {
                        //platform.position.Y++;

                    //}
                //}
                if(!dying) {
                    switch(moving) {
                        case 'idle':
                            break;
                        case 'right':
                            world.addBB(0, platform.position.X, platform.position.Y, render.bbox);
                            platform.setAnimation('walk');
                            platform.position.X++;
                            world.addBB(platform, platform.position.X, platform.position.Y, render.bbox);
                            break;
                        case 'left':
                            world.addBB(0, platform.position.X, platform.position.Y, render.bbox);
                            platform.setAnimation('walk');
                            platform.position.X--;
                            world.addBB(platform, platform.position.X, platform.position.Y, render.bbox);
                            break;
                    }
                }
            }
        }
    });

    return platform;
};

module.exports = Platform;

},{"./thing":8,"jsgtb":7}],7:[function(require,module,exports){
module.exports = {
    canvas: require('./canvas'),
    CollisionBox: require('./collisionbox'),
    Container: require('./container'),
    easing: require('./easing'),
    events: require('./events'),
    game: require('./game'),
    GameObject: require('./gameobject'),
    gamePad: require('./gamepad'),
    GameState: require('./gamestate'),
//    GL: require('./gl'),
    keys: require('./keys'),
    Menu: require('./menu'),
    Particles: require('./particles'),
    racket: require('./racket'),
    raf: require('./raf'),
    Resources: require('./resources'),
    Simplex: require('./simplex'),
    sponge: require('./sponge'),
    StateMachine: require('./statemachine')
};

},{"./canvas":11,"./collisionbox":12,"./container":13,"./easing":14,"./events":15,"./game":16,"./gameobject":17,"./gamestate":18,"./gamepad":19,"./keys":20,"./menu":21,"./particles":22,"./racket":23,"./raf":24,"./resources":25,"./simplex":26,"./sponge":27,"./statemachine":28}],11:[function(require,module,exports){
var canvas = document.getElementsByTagName("canvas")[0];

function Canvas(canvas) {
    canvas = canvas || document.createElement("canvas");
    // canvas.style.zIndex = 55;
    var context = canvas.getContext("2d");
    var C = {
        element: canvas,
        context: context,
        imageData: function(data) {
            if(data) {
                context.putImageData(data, 0, 0);
            }
            return context.getImageData(0, 0, canvas.width, canvas.height);
        },
        create: function(size) {
            var newCanvas = Canvas();
            newCanvas.size(size);
            return newCanvas;
        },
        clone: function(empty) {
            var clone = Canvas();
            clone.size(C.size());
            if(!empty) {
                clone.context.drawImage(C.element, 0,  0);
            }
            return clone;
        },
        clear: function(color) {
            if(!color) {
                canvas.width = canvas.width;
            } else {
                context.save();
                context.fillStyle = color;
                context.fillRect(0, 0, canvas.width, canvas.height);
                context.restore();
            }
        },
        size: function(w, h) {
            if(w) {
                if(typeof(w) === "object") {
                    canvas.width = w.W || w.width;
                    canvas.height = w.H || w.height;
                } else {
                    canvas.width = w;
                    canvas.height = h;
                }
            }
            return { width: canvas.width, height: canvas.height };
        }
    };
    Object.defineProperty(C, "width", {
        get: function() { return canvas.width; },
        set: function(w) { canvas.width = w; }
    });
    Object.defineProperty(C, "height", {
        get: function() { return canvas.height; },
        set: function(h) { canvas.height = h; }
    });

    C.position = (function() {
        var x = 0,
            y = 0,
            parent = C.element;
        while(parent) {
            x += parent.offsetLeft;
            y += parent.offsetTop;
            parent = parent.parentElement;
        }
        return {X: x, Y: y};
    }());

    return C;
}

module.exports = Canvas(canvas);

},{}],13:[function(require,module,exports){
var Container = function() {
    var items = [];
    var container = {
        noncollider: true,
        count: function() {
            return items.length;
        },
        add: function(item) {
            items.push(item);
        },
        remove: function(item) {
            for(var i = items.length -1; i >= 0; --i) {
                if(items[i] === item) {
                    items.splice(i, 1);
                    break;
                }
            }
        },
        each: function(cb) {
            for(var i = 0; i < items.length; i++) {
                cb(items[i]);
            }
        },
        draw: function() {
            container.each(function(item) {
                item.draw();
            });
        }
    };
    return container;
};
module.exports = Container;

},{}],12:[function(require,module,exports){
var CollisionBox = function(data) {
    "use strict";
    var collisionbox = {
        dirty: false,
        die: function() {
            return false;
        },
        position: { X: data.x + data.width / 2, Y: data.y + data.height / 2 },
        draw: function() { return false; },
        boundingbox: [-(data.width / 2),
                      -(data.height / 2),
                      data.width,
                      data.height],
        type: "collisionbox"
    };
    return collisionbox;
};
module.exports = CollisionBox;

},{}],14:[function(require,module,exports){
module.exports = function (t, b, c, d) {
    if ((t/=d) < (1/2.75)) {
        return c*(7.5625*t*t) + b;
    } else if (t < (2/2.75)) {
        return c*(7.5625*(t-=(1.5/2.75))*t + 0.75) + b;
    } else if (t < (2.5/2.75)) {
        return c*(7.5625*(t-=(2.25/2.75))*t + 0.9375) + b;
    } else {
        return c*(7.5625*(t-=(2.625/2.75))*t + 0.984375) + b;
    }
};

},{}],15:[function(require,module,exports){
module.exports = {
    attach: function(obj) {
        var eventList = {},
            eventTarget = {
                on: function(ev, f) {
                    if(!eventList[ev]) eventList[ev] = [];
                    eventList[ev].push(f);
                    return obj;
                },
                fire: function(ev, evobj) {
                    if(eventList[ev]) {
                        for(var i = 0; i < eventList[ev].length; i++) {
                            if(eventList[ev][i].call(obj, evobj)) {
                                return;
                            }
                        }
                    }
                },
                remove: function(ev, f) {
                    if(!eventList[ev]) {
                        return;
                    }
                    for(var i = 0; i < eventList[ev].length; i++) {
                        if(eventList[ev][i] === f) {
                            eventList[ev].splice(i, 1);
                            break;
                        }
                    }
                }
            };
        for(var prop in eventTarget) {
            obj[prop] = eventTarget[prop];
        }
    }
};
module.exports.attach(module.exports);

},{}],17:[function(require,module,exports){
'use strict';
var GameObject = function(object, events) {
    var construct = (this instanceof GameObject);
    var create = function(object) {
        var eventList = {};
        var subStates = [];
        var gameObject = function(object) {
            object = object || {};
            var properties = Object.getOwnPropertyNames(object);
            for(var i = 0; i < properties.length; i++) {
                var prop = properties[i];
                var desc = Object.getOwnPropertyDescriptor(object, prop);
                Object.defineProperty(gameObject, prop, desc);
            }
            return gameObject;
        };

        gameObject({
            on: function(ev, f) {
                if(!eventList[ev]) {
                    eventList[ev] = [];
                }
                eventList[ev].push(f);
                return gameObject;
            },
            fire: function(ev, evobj, stat) {
                var i;
                stat = stat || { stop: false };
                if(eventList[ev]) {
                    for(i = 0; i < eventList[ev].length; i++) {
                        if(eventList[ev][i].call(gameObject, evobj)) {
                            stat.stop = true;
                            break;
                        }
                    }
                }
                if(subStates.length > 0 && !stat.stop) {
                    for(i = 0; i < subStates.length; i++) {
                        subStates[i].fire(ev, evobj, stat);
                        if(stat.stop) {
                            break;
                        }
                    }
                }
                return gameObject;
            },
            clearEventListeners: function() {
                eventList = {};
            },
            removeEventListener: function(ev, f) {
                if(!eventList[ev]) {
                    return;
                }
                for(var i = 0; i < eventList[ev].length; i++) {
                    if(eventList[ev][i] === f) {
                        eventList[ev].splice(i, 1);
                        break;
                    }
                }
                return gameObject;
            },
            add: function(state) {
                subStates.push(state);
                return gameObject;
            },
            remove: function(state) {
                for(var i = 0; i < subStates.length; i++) {
                    if(subStates[i] === state) {
                        subStates.splice(i, 1);
                        console.log('remove sub-state ' + i);
                        return gameObject;
                    }
                }
                return gameObject;
            }
        });
        if(events) {
            for(var key in events) {
                gameObject.on(key, events[key]);
            }
        }
        return gameObject(object);
    }
    if(construct) {
        return create(object);
    } else {
        return function(options) {
            var gameObject = create(object);
            return gameObject(options);
        }
    }
};

module.exports = GameObject;

},{}],20:[function(require,module,exports){
module.exports = {
    BACKSPACE:8,
    TAB:9,
    ENTER:13,
    SHIFT:16,
    CTRL:17,
    ALT:18,
    PAUSE:19,
    CAPSLOCK:20,
    ESC:27,
    SPACE:32,
    PAGEUP:33,
    PAGEDOWN:34,
    END:35,
    HOME:36,
    LEFT:37,
    UP:38,
    RIGHT:39,
    DOWN:40,
    INSERT:45,
    DELETE:46,
    F1:112,
    F2:113,
    F3:114,
    F4:115,
    F5:116,
    F6:117,
    F7:118,
    F8:119,
    F9:120,
    F10:121,
    F11:122,
    F12:123,
    W: 87,
    A: 65,
    S: 83,
    D: 68,
    NUMLOCK:144,
    SCROLLLOCK:145
};

},{}],23:[function(require,module,exports){
(function(){/*jshint newcap:false, nonew:true, browser:true, node:true */
/*global console, define */
"use strict";
function audio(files, callback) {
    var file = new Audio(),
        maxChannels = 3,
        channels = [],
        fileType = files.substr(files.lastIndexOf(".") + 1).toLowerCase();

    callback = callback || function(success) { console.log("no callback set for loading audio."); };
    var rfile = {
        canPlay: {
            "mp3": file.canPlayType("audio/mpeg"),
            "ogg": file.canPlayType("audio/ogg"),
            "wav": file.canPlayType("audio/wav")
        },
        volume: function(vol) {
            for(var i = 0; i < channels.length; i++) {
                channels[i].volume = vol;
            }
        },
        play: function(loop) {
            for(var i = 0; i < maxChannels; i++) {
                if(i >= channels.length) {
                    channels[i] = new Audio(files);
                    if(channels[i].load) {
                        channels[i].load();
                    }
                }
                if(channels[i].currentTime === 0 || channels[i].ended) {
                    channels[i].loop = loop;
                    channels[i].play();
                    return;
                }
            }
            //if all else fails.
            channels[0].pause();
            channels[0].loop = loop;
            channels[0].currentTime = 0;
            channels[0].play();
        },
        stop: function() {
            for(var i = 0; i < channels.length; i++) {
                if(channels[i] && !channels[i].paused) {
                    channels[i].pause();
                    channels[i].currentTime = 0;
                }
            }
        }
    };
    if(!rfile.canPlay[fileType]) {
        callback(false);
        console.log("This filetype cannot be played on this browser: " + fileType);
    } else {
        //for(var i = 0; i < maxChannels; i++) {
            channels.push(new Audio(files));
            if(channels[0].load) {
                channels[0].load();
            }
        //}
        callback(true);
    }
    return rfile;
}

module.exports = {
    create: audio
};


})()
},{}],24:[function(require,module,exports){
var requestAnimationFrame = (
        window.requestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(cb) { setTimeout(cb, 17); }
);
module.exports = requestAnimationFrame;


},{}],26:[function(require,module,exports){
/*
 * A speed-improved simplex noise algorithm for 2D, 3D and 4D in Java.
 *
 * Based on example code by Stefan Gustavson (stegu@itn.liu.se).
 * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).
 * Better rank ordering method by Stefan Gustavson in 2012.
 *
 * This could be speeded up even further, but it's useful as it is.
 *
 * Version 2012-03-09
 *
 * This code was placed in the public domain by its original author,
 * Stefan Gustavson. You may use it as you see fit, but
 * attribution is appreciated.
 *
 * 2D version ported to Javascript by Armen138
 * original at: http://staffwww.itn.liu.se/~stegu/simplexnoise/SimplexNoise.java
 */

 // Inner class to speed upp gradient computations
// (array access is a lot slower than member access)
var Simplex = function(){
  var grad, p, perm, permMod12, F2, G2;
  function reseed(data) {
    grad = [{X: 1, Y: 1},{X: -1, Y: 1},{X: 1, Y: -1},{X: -1, Y: -1},
           {X: 1, Y: 0},{X: -1, Y: 0},{X: 1, Y: 0},{X: -1, Y: 0},
           {X: 0, Y: 1},{X: 0, Y: -1},{X: 0, Y: 1},{X: 0, Y: -1}];
    if(typeof(data) === "undefined") {
      data = {};
    }
    p = data.p || [];
    perm = [];
    permMod12 = [];
    F2 = data.F2 || 0.5*(Math.sqrt(3.0)-1.0);
    G2 = data.G2 || (3.0-Math.sqrt(3.0))/6.0;

    // To remove the need for index wrapping, double the permutation table length
    for(var i = 0; i < 512; i++) {
      if(!data.p) {
        p.push(Math.floor(Math.random() * 255));
      }
      perm.push(p[i & 255]);
      permMod12.push(perm[i] % 12);
    }
  }

  function dot(g, x, y) {
    return g.X*x + g.Y*y;
  }
  function contrib(t, gi, x, y) {
    return  t < 0 ? 0 : Math.pow(t, 4) * dot(grad[gi], x, y);
  }
  reseed();
  // 2D simplex noise
  return {
    setseed: function(data) {
      G2 = data.G2;
      F2 = data.F2;
      p = data.p;
      reseed(data);
    },
    noise: function(xin, yin) {
      // Skew the input space to determine which simplex cell we're in
      var s = (xin+yin)*F2, // Hairy factor for 2D
          i = (xin+s) | 0,
          j = (yin+s) | 0,
          t = (i+j)*G2,
          x0 = xin-(i-t), // The x,y distances from the cell origin
          y0 = yin-(j-t),
          i1, j1, x1, x2, y1, y2, ii, jj, gi0, gi1, gi2, n;
      // For the 2D case, the simplex shape is an equilateral triangle.
      // Determine which simplex we are in.
      //var i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords
      if(x0>y0) {i1=1; j1=0;} // lower triangle, XY order: (0,0)->(1,0)->(1,1)
      else {i1=0; j1=1;}      // upper triangle, YX order: (0,0)->(0,1)->(1,1)
      // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and
      // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where
      // c = (3-sqrt(3))/6
      x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords
      y1 = y0 - j1 + G2;
      x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords
      y2 = y0 - 1.0 + 2.0 * G2;
      // Work out the hashed gradient indices of the three simplex corners
      ii = i & 255;
      jj = j & 255;
      gi0 = permMod12[ii+perm[jj]];
      gi1 = permMod12[ii+i1+perm[jj+j1]];
      gi2 = permMod12[ii+1+perm[jj+1]];

      // Calculate the contribution from the three corners
      n = contrib(0.5 - x0*x0-y0*y0, gi0, x0, y0) +
          contrib(0.5 - x1*x1-y1*y1, gi1, x1, y1) +
          contrib(0.5 - x2*x2-y2*y2, gi2, x2, y2);

      // Add contributions from each corner to get the final noise value.
      // The result is scaled to return values in the interval [-1,1].
      return 70.0 * n;
    }
  };
};

module.exports = Simplex;
/*
function SimplexNoise() {

}
*/

},{}],27:[function(require,module,exports){
//attach a sponge to an object to allow it to absorb other objects (mixins)
module.exports = {
    attach: function(obj) {
        obj.absorb = function(other) {
            for(var property in other) {
                if(other.hasOwnProperty(property)) {
                    var descriptor = Object.getOwnPropertyDescriptor(other, property);
                    Object.defineProperty(obj, property, descriptor);
                }
            }
        };
    }
};

},{}],16:[function(require,module,exports){
'strict mode';
/*jshint node:true */
'use strict';
var raf = require('./raf');
var Canvas = require('./canvas');
var before = 0;
//var StateMachine = require('./statemachine');
var Resources = require('./resources');
var gamePad = require('./gamepad');
var game = {
        mouse: [],
        run: function() {
            var now = Date.now();
            var frameTime = now - before;
            if(game.state) {
                game.state.fire('update', { now:  now, frameTime: frameTime });
                game.state.fire('draw', { canvas: Canvas, now: now, frameTime: frameTime });
            }
            before = now;
            raf.call(window, game.run);
        },
        Resources: Resources,
        touches: {}
    },
    state = null;

Object.defineProperty(game, 'state', {
    get: function() {
        return state;
    },
    set: function(newstate) {
        if(state) {
            state.fire('clear');
        }
        newstate.fire('init');
        state = newstate;
    }
});

document.addEventListener('keyup', function(e) {
    if(game.state) {
        game.state.fire('keyup', {
            code: e.keyCode,
            ctrl: e.ctrlKey,
            alt: e.altKey,
            shift: e.shiftKey
        });
    }
});
document.addEventListener('keydown', function(e) {
    if(game.state) {
        game.state.fire('keydown', {
            code: e.keyCode,
            ctrl: e.ctrlKey,
            alt: e.altKey,
            shift: e.shiftKey
        });
    }
});

window.addEventListener('mousemove', function(e) {
    if(game.state) {
        var x = e.clientX - Canvas.position.X;
        var y = e.clientY - Canvas.position.Y;
        game.state.fire('mousemove', {X: x, Y: y});
    }
});

document.addEventListener('mousedown', function(e) {
    game.mouse[e.button] = Date.now();
    e.preventDefault();
    if(game.state) {
        var x = e.clientX - Canvas.position.X;
        var y = e.clientY - Canvas.position.Y;
        game.state.fire('mousedown', {X: x, Y: y, button: e.button});
    }
});


document.addEventListener('mouseup', function(e) {
    var now = Date.now();
    var x, y;
    console.log(now - game.mouse[e.button]);
    if(now - game.mouse[e.button] < 150) {
        if(game.state) {
            x = e.clientX - Canvas.position.X;
            y = e.clientY - Canvas.position.Y;
            game.state.fire('click', {X: x, Y: y, button: e.button});
        }
    }
    game.mouse[e.button] = null;
    if(game.state) {
        x = e.clientX - Canvas.position.X;
        y = e.clientY - Canvas.position.Y;
        game.state.fire('mouseup', {X: x, Y: y, button: e.button});
    }
});

window.addEventListener('touchstart', function(e) {
    if(game.state) {
        var touches = e.changedTouches;
        if(touches.length > 0) {
            var x = (touches[0].pageX | 0);// - Canvas.position.X;
            var y = (touches[0].pageY | 0);// - Canvas.position.Y;
            game.state.fire('touchstart', touches);
            game.touches[touches[0].identifier] = Date.now();
        }
    }
});


window.addEventListener('touchmove', function(e) {
    if(game.state) {
        var touches = e.changedTouches;
        if(touches.length > 0) {
            var x = (touches[0].pageX | 0);// - Canvas.position.X;
            var y = (touches[0].pageY | 0);// - Canvas.position.Y;
            game.state.fire('touchmove', touches);
        }
    }
});

window.addEventListener('touchend', function(e) {
    var touches = e.changedTouches;
    var x, y;
    if(game.state) {
        if(touches.length > 0) {
            x = (touches[0].pageX | 0);// - Canvas.position.X;
            y = (touches[0].pageY | 0);// - Canvas.position.Y;
            game.state.fire('touchend', touches);

        }
    }
});

gamePad.on('button', function(e) {
    if(game.state) {
        game.state.fire('button', e);
    }
});

gamePad.on('axis', function(e) {
    if(game.state) {
        game.state.fire('axis', e);
    }
});

gamePad.on('angle', function(e) {
    if(game.state) {
        game.state.fire('angle', e);
    }
});


module.exports = game;


},{"./raf":24,"./canvas":11,"./resources":25,"./gamepad":19}],18:[function(require,module,exports){
var GameObject = require("./gameobject");
var GameState = function() {
    var gameState = new GameObject();
    return gameState;
};

module.exports = GameState;

},{"./gameobject":17}],19:[function(require,module,exports){
/*jshint node:true */
'use strict';
var raf = require('./raf');
var Events = require('./events');

var buttonStates = [];
var axisStates = [];
var lastPad = null;
var padID = null;
var lastAngle = 0;
var gamepad = {
    deadzone: 0.5,
    poll: function() {
        var i;
        var pad = navigator.webkitGetGamepads && navigator.webkitGetGamepads()[0];
        if(pad) {
            if(!padID) {
                padID = pad.id;
                //console.log('gamepad: ' + padID);
            }
            for(i = 0; i < pad.buttons.length; i++) {
                if(pad.buttons[i] !== 0) {
                    if(!buttonStates[i]) {
                        gamepad.fire('button', { which: i, action: 'down'});
                        buttonStates[i] = true;
                    }
                } else {
                    if(buttonStates[i]) {
                        gamepad.fire('button', { which: i, action: 'up'});
                        buttonStates[i] = false;
                    }
                }
            }
            for(i = 0; i < pad.axes.length; i++) {
                if(Math.abs(pad.axes[0]) > gamepad.deadzone ||
                    Math.abs(pad.axes[1]) > gamepad.deadzone) {
                    //calc axis and fire event
                    var angle = Math.atan2(pad.axes[1], pad.axes[0]);
                    var a = Math.abs(pad.axes[0]);
                    var b = Math.abs(pad.axes[1]);

                    var strength = Math.sqrt(a * a + b * b);
                    gamepad.fire('angle', { value: angle, strength: strength });
                    lastAngle = angle;
                } else {
                    if(lastAngle !== 0) {
                        gamepad.fire('angle', { value: 0, strength: 0 });
                        lastAngle = 0;
                    }
                }
                if(Math.abs(pad.axes[i]) > gamepad.deadzone) {
                    gamepad.fire('axis', { which: i, value: pad.axes[i], action: 'engage' });
                } else {
                    if(Math.abs(axisStates[i]) > gamepad.deadzone) {
                        gamepad.fire('axis', {which: i, value: pad.axes[i], action: 'release'});
                    }
                }
                axisStates[i] = pad.axes[i];
            }
            lastPad = pad;
        }
        raf.call(window, gamepad.poll);
    },
    A: 0,
    B: 1,
    X: 2,
    Y: 3
};

Events.attach(gamepad);
gamepad.poll();

module.exports = gamepad;

},{"./raf":24,"./events":15}],21:[function(require,module,exports){
    var easing = require("./easing");
    var Resources = require("./resources");
    var color = "rgba(0, 0, 0, 0.7)",
        width = 324,
        buffer = 80,
        duration = 500;


    function hit(index, pos) {
        var rect = {X: 10, Y: 10 + (index * 120), W: 280, H: 100};
        if (pos.X > rect.X &&
            pos.X < rect.X + rect.W &&
            pos.Y > rect.Y && pos.Y < rect.Y + rect.H) {
            return true;
        }
        return false;
    }
    var Menu =  function(canvas, menu, splash) {
        var start = 0, from, to,
            position = {X: 0, Y: 0},
            context = canvas.getContext("2d"),
            splashX = 0;
        var paused = {
            font: "48px Rationale",
            click: function(mouse) {
                //menu[0].action();
                if(mouse.X < width) {
                    for(var i = 0; i < menu.length; i++) {
                        if(hit(i, mouse)) {
                            menu[i].action();
                        }
                    }
                }
            },
            run: function() {
                if(start === 0) return;
                var now = Date.now() - start,
                    sign = -1,
                    splashStart = canvas.width;
                if(splash && to < 0) {
                    sign = 1;
                    splashStart = canvas.width - splash.width;
                }
                if(now < duration) {
                    position.X = easing(now, from, to, duration) | 0;
                    if(splash) {
                        splashX = easing(now, splashStart, sign * splash.width, duration) | 0;
                    }
                } else {
                    position.X = from + to;
                    if(splash) {
                        splashX = canvas.width - splash.width;
                    }
                    if(to < 0 && paused.done) {
                        paused.done();
                    }
                }
                context.save();
                context.drawImage(paused.background, 0, 0);
                if(splash) {
                    context.drawImage(Resources[splash], splashX, canvas.height / 2 - splash.height / 2);
                }
                context.fillStyle = color;
                context.fillRect(position.X - buffer, position.Y, width + buffer, canvas.height);
                context.translate(position.X, position.Y);

                context.textBaseline = "middle";
                context.textAlign = "center";
                context.font = paused.font;
                for(var i = 0; i < menu.length; i++) {
                    var iconSpace = menu[i].icon ? 37 : 0;
                    if(menu[i].label) {
                        context.fillStyle = color;
                        //context.strokeRect(10, 10 + (i * 120), 280, 100);
                        context.fillStyle = "white";
                        context.fillText(menu[i].label, 10 + 140 + iconSpace, 10 + 50 + (i * 120));
                    }
                    if(menu[i].icon) {
                        context.drawImage(menu[i].icon, 0, 0, menu[i].icon.width, menu[i].icon.height, 37, 37 + (i * 120), 48, 48);
                    }
                }
                context.restore();
            },
            init: function() {
                paused.background = document.createElement("canvas");
                paused.background.width = canvas.width;
                paused.background.height = canvas.height;
                paused.background.getContext("2d").drawImage(canvas, 0, 0);

                start = Date.now();
                from = -width;
                to = width;
                position.X = from;
            },
            lifetime: function() {
                return Date.now() - start;
            },
            clear: function(cb) {
                paused.time = Date.now() - start;
                start = Date.now();
                from = 0;
                to = -width;
                position.X = from;
                paused.done = cb;
            }
        };
        return paused;
    };
    module.exports = Menu;

},{"./easing":14,"./resources":25}],22:[function(require,module,exports){
    var Canvas = require("./canvas");
    var Resources = require("./resources");
    var Events = require("./events");
    var Position = function(x, y) {
        return {X: x, Y: y};
    };

    Position.copy = function(position) {
        return {X: position.X, Y: position.Y};
    };

    function createParticle(options) {
        var dead = false;
        var particle = {
            then: Date.now(),
            birth: Date.now(),
            angle: 0,
            unborn: true,
            ttl: Math.random() * (options.ttl.max - options.ttl.min),
            reset: function(position) {
                if(particle.dead) {
                    particle.unborn = true;
                    return;
                }
                var now = Date.now();
                var direction = Math.random() * (2 * Math.PI);
                particle.position = Position.copy(options.position);
                particle.startPosition = Position.copy(options.position);
                particle.birth = now;
                particle.alpha = 1.0;
                particle.unborn = false;
                particle.then = now;
                particle.image = Resources[options.image];
                particle.direction = Position(Math.cos(direction), Math.sin(direction));
                particle.scale = Math.random() * (options.scale.max - options.scale.min) + options.scale.min;
                particle.speed = Math.random() * (options.speed.max - options.speed.min) + options.speed.min;
                particle.ttl = Math.random() * (options.ttl.max - options.ttl.min) + options.ttl.min;
                //console.log(particle.direction);
            },
            die: function() {
                particle.dead = true;
            },
            update: function(position) {
                var now = Date.now();
                var life = now - particle.birth;
                if(life > particle.ttl) {
                    particle.reset(options.position);
                } else {
                    if(!particle.unborn) {
                        var distance = life * particle.speed;
                        //console.log(distance);
                        particle.position.X = particle.startPosition.X + distance * particle.direction.X;
                        particle.position.Y = particle.startPosition.Y + distance * particle.direction.Y;
                        particle.angle += 0.1;
                        particle.alpha = 1 - (life / particle.ttl);
                        //console.log(particle.startPosition);
                        // particle.scale -= 0.01;
                        // if(particle.scale < 0) particle.scale = 0;
                    }
                }
                particle.then = now;
            },
            draw: function() {
                if(!particle.unborn) {
                    Canvas.context.save();
                    //Canvas.context.globalCompositeOperation = "lighter";
                    Canvas.context.translate(particle.position.X, particle.position.Y);
                    Canvas.context.scale(particle.scale, particle.scale);
                    Canvas.context.rotate(particle.angle);
                    Canvas.context.globalAlpha = particle.alpha;
                    Canvas.context.drawImage(particle.image, -particle.image.width / 2, -particle.image.height / 2);
                    Canvas.context.restore();
                }
            }
        };
        return particle;
    }
    var particles = function(options) {
        var ttl = options.systemTtl || 0;
        var birth = Date.now();
        var position = {X: 100, Y:100};
        var angle = 1;
        // var options = {
        //  position: position,
        //  image: image,
        //  scale: {min: 0.1, max: 0.4},
        //  speed: {min: 0.01, max:0.04},
        //  ttl: {min: 30, max: 1000},
        //  count: 50
        // };
        var particleList = [];
        // for(var i = 0; i < options.count; i++) {
        //  particleList.push(createParticle(options));
        // }
        var direction = {X: 4, Y: 4};
        var i;
        var p = {
            position: options.position,
            draw: function() {
                p.run();
            },
            keyup: function(key) {
                if(key === 32) {
                    p.kill();
                }
            },
            kill: function() {
                ttl = 1;
            },
            run: function() {
                if(p.dead) {
                    return;
                }
                if(options.count > particleList.length) {
                    for(i = 0; i < options.count - particleList.length; i++){
                        particleList.push(createParticle(options));
                    }
                }
                if(options.count < particleList.length) {
                    particleList.length = options.count | 0;
                }
                var now = Date.now();
                var deadParticles = 0;
                for(i = 0; i < particleList.length; i++) {
                    particleList[i].update();
                    particleList[i].draw();
                    if(ttl !== 0 && now - birth > ttl) {
                        particleList[i].die();
                    }
                    if(particleList[i].dead && particleList[i].unborn) {
                        deadParticles++;
                    }
                    if(deadParticles === particleList.length) {
                        p.fire("death");
                        p.dead = true;
                    }
                }
            },
            init: function() {
                console.log("init particles");
            }
        };
        Events.attach(p);
        return p;
    };
    module.exports = particles;

},{"./canvas":11,"./resources":25,"./events":15}],25:[function(require,module,exports){
var GameObject = require("./gameobject");
var Racket = require("./racket");

var resources = new GameObject();
var meshLoader = null;
resources({
    loaded: 0,
    load: function(files) {
        var audio = /(wav$|mp3$|ogg$)/;
        var mesh = /(3d$|js$|json$)/;
        var total = Object.getOwnPropertyNames(files).length;
        var progress = 0;
        var fetch = {
            audio: function(file) {
                resources[file] = Racket.create(files[file], function(success) {
                    if(!success) {
                        console.log("failed to load audio: " + file);
                    }
                    loaded(file);
                });
            },
            mesh: function(file) {
                if(typeof(THREE) === "undefined") {
                    throw "THREE does not exist; cannot load resource " + file;
                }
                meshLoader = meshLoader || new THREE.JSONLoader();
                meshLoader.load(files[file], function(geometry, material) {
                    for(var i = 0; i < material.length; i++) {
                        material[i].shading = THREE.FlatShading;
                    }
                    var faceMaterial = new THREE.MeshFaceMaterial(material);
                    resources[file] = { geometry: geometry, material: faceMaterial }; //new THREE.Mesh(geometry, faceMaterial);
                    loaded(file);
                });
            },
            image: function(file) {
                var img = new Image();
                img.onload = function() {
                    loaded(file);
                };
                img.onerror = function() {
                    //fail silently.
                    console.log("failed to load: " + files[file]);
                    loaded(file);
                };
                img.src = files[file];
                img.setAttribute("name", file);
                resources[file] = img;
            }
        };
        var loaded = function(file) {
            resources.fire("progress", file);
            resources.loaded++;
            progress++;
            if(progress === total) {
                resources.fire("load", files);
            }
            console.log("loaded: " + file);
        };

        for(var file in files) {
            if(resources.hasOwnProperty(file)) {
                throw "naming conflict; cannot load resource " + file;
            }
            var type = "image";
            type = audio.test(files[file]) ? "audio" : type;
            type = mesh.test(files[file]) ? "mesh" : type;
            //total++;
            fetch[type](file);
        }
        return resources;
    }
});
var Resources = function(files) {
    if(files) {
        resources.load(files);
    }
    return resources;
};
//ddam vervvv;
//var meshLoader = null;
//var audio = /(wav$|mp3$|ogg$)/;
//var mesh = /(3d$|js$|json$)/;
//var resources = {
    //loaded: 0,
    //load: function(files) {
        //resources.load.total = 0;
        //resources.load.loaded = 0;
        //function loaded(file) {
            //resources.load.loaded++;
            //resources.fire("progress", file);
            //if(resources.load.loaded === resources.load.total) {
                //resources.fire("load");
            //}
        //}
        //for(var file in files) {
            //if(resources[file]) {
                //throw "naming conflict: cannot load resource named " + file;
            //}
            //var type = "image";
            //console.log(file + " is audio: " + audio.test(files[file]));
            //if(audio.test(files[file])) {
                //type = "audio";
            //}
            //if(mesh.test(files[file])) {
                //type = "mesh";
            //}
            //resources.load.total++;
            //switch(type) {
                //case "audio":
                    //(function(file) {
                        //resources[file] = Racket.create(files[file], function(success) {
                            //if(!success) {
                                //console.log("failed to load: " + files[file]);
                            //}
                            //loaded(file);
                        //});
                    //}(file));
                //break;
                //case "mesh":
                    //if(meshLoader === null) {
                        //meshLoader = new THREE.JSONLoader();
                    //}
                    //(function(file) {
                        //meshLoader.load(files[file], function(geometry, material) {
                            //console.log(material);
                            //console.log("3d file loaded: " + file);
                            //for(var i = 0; i < material.length; i++) {
                                //material[i].shading = THREE.FlatShading;
                            //}
                            //var faceMaterial = new THREE.MeshFaceMaterial(material);
                            //resources[file] = { geometry: geometry, material: faceMaterial }; //new THREE.Mesh(geometry, faceMaterial);
                            //loaded(file);
                        //});
                    //}(file));
                //break;
                //default:
                    //var img = new Image();
                    //(function(img, file){
                        //img.onload = function() {
                            //loaded(file);
                        //};
                        //img.onerror = function() {
                            ////fail silently.
                            //console.log("failed to load: " + files[file]);
                            //loaded(file);
                        //};
                    //}(img, file));
                    //img.src = files[file];
                    //img.setAttribute("class", "resources");
                    //img.setAttribute("name", file);
                    //resources[file] = img;
                //break;
            //}
        //}
    //}
//};

//events.attach(resources);
//window._GAME_RESOURCES_ = resources;
module.exports = Resources;

},{"./gameobject":17,"./racket":23}],28:[function(require,module,exports){
var GameObject = require("./gameobject");
var StateMachine = function() {
    var state  = null;
    var before = 0;
    var stateMachine = new GameObject();
    stateMachine({
        run: function() {
            var now = Date.now();
            var frameTime = now - before;
            if(stateMachine.state) {
                stateMachine.state.fire("update", { now:  now, frameTime: frameTime });
                stateMachine.state.fire("draw", { canvas: Canvas, now: now, frameTime: frameTime });
            }
            before = now;
            raf.call(window, stateMachine.run);
        },
        state: null
    });
    Object.defineProperty(stateMachine, "state", {
        get: function() {
            return state;
        },
        set: function(newstate) {
            if(state) {
                state.fire("clear");
            }
            newstate.fire("init");
            state = newstate;
        }
    });
    return stateMachine;
};

module.exports = StateMachine;

},{"./gameobject":17}]},{},[3])
;